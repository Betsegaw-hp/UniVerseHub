<% 
    let categories = [];
    let posts = [];
    if(data) {
        categories = data.categories;
        posts = data.posts;
        console.log(posts[0].author)
    }
%>

<!DOCTYPE html>
<html lang="en">
    <%- include('../partials/head')  %> 
<body>
    <%- include('../partials/nav')  %>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8">
                <h1 class="mb-4">UniVerseHub Forums</h1>
                <div class="mb-4">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newTopicModal">
                        <i class="bi bi-plus-circle"></i> Start New Topic
                    </button>
                </div>
                <div class="list-group">
                    <% if (categories.length > 0) { %>
                        <% categories.forEach(category => { %>
                          <a href="/category/<%= category._id %>" class="list-group-item list-group-item-action forum-card" >
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1"><%= category.name %></h5>
                                <small>3 new posts</small>
                            </div>
                            <p class="mb-1"> <%= category.description %> </p>
                            <small>1.2k topics · 5.6k posts</small>
                          </a>
                        <% }) %>
                      <% } else { %>
                        <p>There is no category to display...</p>
                      <% } %>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header">
                        Recent Topics
                    </div>
                    <ul class="list-group list-group-flush">
                        <% if (posts.length > 0) { %>
                            <% posts.forEach(post => { %>
                                <li class="list-group-item">
                                    <a href="/forum/<%= post._id %>" class="text-decoration-none">
                                        <%= post.title %>
                                    </a>
                                    <br><small class="text-muted">
                                        by <%= post.author.username %> · <%= post.createdAt ? new Date(post.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : "sometime" %>  ago
                                    </small>
                                </li>  
                            <% }) %>
                        <% } else { %>
                            <p>There is no posts to display...</p>
                        <% } %>

                        <li class="list-group-item">
                            <a href="#" class="text-decoration-none">Best study spots on campus</a>
                            <br><small class="text-muted">by Mike T. · 5 hours ago</small>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="text-decoration-none">Summer internship opportunities</a>
                            <br><small class="text-muted">by Emily R. · 1 day ago</small>
                        </li>
                        <li class="list-group-item">
                            <a href="#" class="text-decoration-none">New AI course announced!</a>
                            <br><small class="text-muted">by Prof. Johnson · 2 days ago</small>
                        </li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">
                        Forum Statistics
                    </div>
                    <div class="card-body">
                        <p>Total Members: 15,678</p>
                        <p>Total Topics: 3,490</p>
                        <p>Total Posts: 15,700</p>
                        <p>Online Now: 234</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Topic Modal -->
    <div class="modal fade" id="newTopicModal" tabindex="-1" aria-labelledby="newTopicModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newTopicModalLabel">Start a New Topic</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="topicTitle" class="form-label">Topic Title</label>
                            <input type="text" class="form-control" id="topicTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="topicCategory" class="form-label">Category</label>
                            <select class="form-select" id="topicCategory" required>
                                <option value="">Choose a category...</option>
                                <option value="academic">Academic Discussions</option>
                                <option value="campus">Campus Life</option>
                                <option value="career">Career & Internships</option>
                                <option value="tech">Tech Corner</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="topicContent" class="form-label">Content</label>
                            <textarea class="form-control" id="topicContent" rows="5" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Post Topic</button>
                </div>
            </div>
        </div>
    </div>

    <%- include('../partials/footer')  %> 
</body>
</html>